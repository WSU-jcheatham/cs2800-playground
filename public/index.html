<!DOCTYPE html>
<html>
  <head>
    <title>Hello, world!</title>
    <link rel="stylesheet" href="styles.css" />
    <script type="module">
      import { React, ReactDOM } from 'https://unpkg.com/es-react';
      import Circle from './Circle.js';
      import Square from './Square.js';
      import Board from './Board.js';

      const container = document.querySelector('#react-stuff');
      ReactDOM.render(React.createElement(Board), container);

      let bouncers = [];
      const bouncerType = Square;

      const button = document.querySelector('#start-button');
      button.addEventListener('click', () => {
        let r = Math.floor(Math.random() * 255);
        let g = Math.floor(Math.random() * 255);
        let b = Math.floor(Math.random() * 255);
        let color = `rgb(${r}, ${g}, ${b})`;
        const bouncer = {
          Bouncer: Math.random() < 0.25 ? Circle : Square,
          lifetime: Infinity,
          color,
          position: { top: 0, left: 0 },
        };

        bouncers.push(bouncer);

        ReactDOM.render(
          React.createElement(Board, { bouncers }),
          container
        );

        let topDelta = 3;
        let leftDelta = 5;

        bouncer.interval = setInterval(() => {
          ReactDOM.render(
            React.createElement(Board, {
              bouncers,
            }),
            container
          );

          bouncer.position.top += topDelta;
          if (bouncer.position.top + 100 >= 500) {
            topDelta = -topDelta;
            bouncer.position.top += topDelta;
          } else if (bouncer.position.top <= 0) {
            topDelta = -topDelta;
            bouncer.position.top += topDelta;
          }

          bouncer.position.left += leftDelta;
          if (bouncer.position.left + 100 >= 500) {
            leftDelta = -leftDelta;
            bouncer.position.left += leftDelta;
          } else if (bouncer.position.left <= 0) {
            leftDelta = -leftDelta;
            bouncer.position.left += leftDelta;
          }

          bouncer.lifetime--;

          if (bouncer.lifetime < 0) {
            const index = bouncers.indexOf(bouncer);
            bouncers.splice(index, 1);
            clearInterval(bouncer.interval);
            ReactDOM.render(
              React.createElement(Board, {
                bouncers,
              }),
              container
            );
          }
        }, 30);
      });

      const popButton = document.querySelector('#pop-button');
      popButton.addEventListener('click', () => {
        const bouncer = bouncers.shift();
        clearInterval(bouncer.interval);
        ReactDOM.render(
          React.createElement(Board, {
            bouncers,
          }),
          container
        );
      });
    </script>
  </head>
  <body>
    <h1>Hello, world!</h1>

    <div id="react-stuff"></div>

    <br />
    <button id="start-button">Start</button>
    <button id="pop-button">Pop</button>
  </body>
</html>
